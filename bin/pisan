# Script: Main script

# Main config file
source ~/.$USER/pisan.conf
#! $mconf_bashexec

#echo $args_return
if [ ! -z "$conf" ]; then
	source $conf # config file in the local directory can override the default ones
fi

if [ $# -gt 3 ] ; then
	cwd=`pwd`
	cwd=`readlink -f $cwd`
	date=`date`
	echo "[$date] [$HOSTNAME] [$cwd] $@" >> $HOME/.$USER/pisan/pisan.cmds
fi

# export variables
set -a # exports the variables as environment variables --> Useful for R scripts
source $mconf_installdir/src/general_args.sh
source $mconf_installdir/src/basic_functions.sh
set +a # switch it back off

pisan_help() 
{
cat "$mconf_installdir/cfgs/commands"
exit 2
}

if [ $# -eq 0 ] ; then
	pisan_help
fi


case "$1" in
# farm
	"farmsub" )
		source $mconf_installdir/bin/farmsub.sh ;;

# RNASeq
 "star" )
	    source $mconf_installdir/bin/star.sh ;;
	"countTableSTAR" )
		source $mconf_installdir/bin/countTableSTAR.sh ;;
	"deseq2" )
		$mconf_Rscript $mconf_installdir/bin/deseq2.R ;;
	"countTableToTPM" )
		$mconf_Rscript $mconf_installdir/bin/countTableToTPM.R ;;
	# Fusion
		"ericscript" )
			source $mconf_installdir/bin/ericscript.sh ;;
			
# Downloads
	# iRODS
	"irodsDownload" )
		source $mconf_installdir/bin/irodsDownload.sh ;;
	"irodsSampleInfo" )
		source $mconf_installdir/bin/irodsSampleInfo.sh ;;
	"createProject" )
		$mconf_Rscript $mconf_installdir/bin/createProject.R ;;
	"irodsMergeCramsToBam" )
		source $mconf_installdir/bin/irodsMergeCramsToBam.sh ;;
	
# Chipseq	
	"macs2" )
		source $mconf_installdir/bin/macs2.sh ;;
# Procs
   
	"bedGraphToBigWig" )
		source $mconf_installdir/bin/bedGraphToBigWig.sh ;;
	"bammerge" )
		source $mconf_installdir/bin/bammerge.sh ;;
	"bam2bw" )
		source $mconf_installdir/bin/bam2bw.sh ;;
	"bam2fq" )
		source $mconf_installdir/bin/bam2fq.sh ;;

# Visualisation
	"ucscCreateHub" )
		source $mconf_installdir/bin/ucscCreateHub.sh ;;

# Test tools
	"test" )
		source $mconf_installdir/bin/test.sh ;;
	"testR" )
		$mconf_Rscript $mconf_installdir/bin/test.R ;;


esac


