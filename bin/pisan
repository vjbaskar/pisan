# Script: Main script

# Main config file
source ~/.$USER/pisan.conf
#! $mconf_bashexec

#echo $args_return
if [ ! -z "$conf" ]; then
	source $conf # config file in the local directory can override the default ones
fi


cwd=`pwd`
cwd=`readlink -f $cwd`
export cwd=$cwd	
export pisanCommand="$@"

# export variables
set -a # exports the variables as environment variables --> Useful for R scripts
source $mconf_installdir/src/general_args.sh
source $mconf_installdir/src/basic_functions.sh
set +a # switch it back off

pisan_help() 
{
cat "$mconf_installdir/cfgs/commands"
exit 2
}

if [ $# -eq 0 ] ; then
	pisan_help
fi


case "$1" in
# farm
	"farmsub" )
		source $mconf_installdir/bin/farmsub.sh ;;

# RNASeq
 	"star" )
	    source $mconf_installdir/bin/star.sh ;;
	 "salmon" )
	    source $mconf_installdir/bin/salmon.sh ;;
	
	"countTableSTAR" )
		source $mconf_installdir/bin/countTableSTAR.sh ;;
	"deseq2" )
		$mconf_Rscript $mconf_installdir/bin/deseq2.R ;;
	"countTableToTPM" )
		$mconf_Rscript $mconf_installdir/bin/countTableToTPM.R ;;
	
	# Fusion
		"ericscript" )
			source $mconf_installdir/bin/ericscript.sh ;;
			
# Downloads
	# iRODS
	"irodsDownload" )
		source $mconf_installdir/bin/irodsDownload.sh ;;
	"irodsSampleInfo" )
		source $mconf_installdir/bin/irodsSampleInfo.sh ;;
	"createProject" )
		$mconf_Rscript $mconf_installdir/bin/createProject.R ;;
	"irodsMergeCramsToBam" )
		source $mconf_installdir/bin/irodsMergeCramsToBam.sh ;;
	
# Chipseq	
	"macs2" )
		source $mconf_installdir/bin/macs2.sh ;;
	"homerCreateTagDir" )
		source $mconf_installdir/bin/homerCreateTagDir.sh ;;
	"homerHistonePeaks" )
		source $mconf_installdir/bin/homerHistonePeaks.sh ;;
		
# CRISPR
	"mageckCount" )
		source $mconf_installdir/bin/mageckCount.sh ;;
	"mageckCompare" )
		source $mconf_installdir/bin/mageckCompare.sh ;;	
	"mageckXYsgRNA" )
		source $mconf_installdir/bin/mageckXYsgRNA.sh ;;	

# Procs
	"bedGraphToBigWig" )
		source $mconf_installdir/bin/bedGraphToBigWig.sh ;;
	"bammerge" )
		source $mconf_installdir/bin/bammerge.sh ;;
	"bam2bw" )
		source $mconf_installdir/bin/bam2bw.sh ;;
	"bam2fq" )
		source $mconf_installdir/bin/bam2fq.sh ;;
	"filterCols" )
		$mconf_Rscript $mconf_installdir/bin/filterCols.R ;;
	"hist" )
		source $mconf_installdir/bin/hist.sh ; export nohistory=1 ;;	

# Visualisation
	"ucscCreateHub" )
		source $mconf_installdir/bin/ucscCreateHub.sh ;;

# Set operations
	"gsea" )
		source $mconf_installdir/bin/gsea.sh ;;

# Test tools
	"test" )
		source $mconf_installdir/bin/test.sh ;;
	"testR" )
		$mconf_Rscript $mconf_installdir/bin/test.R ;;


esac


